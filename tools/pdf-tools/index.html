<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF & Document Tools</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <!-- Load JSZip first, then epub.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Load epub.js after JSZip is ready -->
    <script>
        // Wait for JSZip to load before loading epub.js
        window.addEventListener('load', function() {
            if (typeof JSZip !== 'undefined') {
                const epubScript = document.createElement('script');
                epubScript.src = 'https://cdn.jsdelivr.net/npm/epubjs@0.3.93/dist/epub.min.js';
                document.head.appendChild(epubScript);
            }
        });
    </script>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p class="loading-text" id="loadingText">Loading document...</p>
    </div>

    <div class="container">
        <a href="../../index.html" class="back-link">‚Üê Back to Tools</a>
        
        <header>
            <h1>üìÑ PDF & Document Tools</h1>
            <p>View, merge, split PDFs, remove passwords, and read EPUB books - all in your browser</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="viewer">üìñ PDF Viewer</button>
            <button class="tab-btn" data-tab="merge">üîó Merge PDFs</button>
            <button class="tab-btn" data-tab="split">‚úÇÔ∏è Split PDF</button>
            <button class="tab-btn" data-tab="unlock">üîì Remove Password</button>
            <button class="tab-btn" data-tab="epub">üìö EPUB Reader</button>
        </div>
        
        <!-- PDF Viewer -->
        <div class="tool-section active" id="viewer">
            <div class="card">
                <h2>PDF Viewer</h2>
                
                <div class="drop-zone" id="viewerDropZone">
                    <div class="drop-zone-icon">üìÑ</div>
                    <p>Drag & drop a PDF file here or click to select</p>
                    <input type="file" id="viewerInput" accept=".pdf,application/pdf">
                </div>
                
                <div id="viewerContent" style="display: none;">
                    <div class="file-info" id="pdfInfo"></div>
                    
                    <div class="pdf-viewer-container">
                        <div class="pdf-sidebar" id="pdfSidebar"></div>
                        
                        <div class="pdf-main">
                            <div class="pdf-controls">
                                <button class="btn btn-secondary" id="prevPage">‚Üê Prev</button>
                                <span>Page </span>
                                <input type="number" id="pageNum" min="1" value="1">
                                <span> of <span id="totalPages">0</span></span>
                                <button class="btn btn-secondary" id="nextPage">Next ‚Üí</button>
                                
                                <select id="zoomLevel">
                                    <option value="0.5">50%</option>
                                    <option value="0.75">75%</option>
                                    <option value="1" selected>100%</option>
                                    <option value="1.25">125%</option>
                                    <option value="1.5">150%</option>
                                    <option value="2">200%</option>
                                    <option value="fit-width">Fit Width</option>
                                    <option value="fit-page">Fit Page</option>
                                </select>
                                
                                <select id="viewMode">
                                    <option value="single">Single Page</option>
                                    <option value="continuous">Continuous</option>
                                </select>
                                
                                <button class="btn btn-secondary" id="rotatePdf">üîÑ Rotate</button>
                                <button class="btn btn-primary" id="downloadPdf">üíæ Download</button>
                            </div>
                            
                            <!-- Enhanced PDF controls -->
                            <div class="pdf-enhanced-controls">
                                <div class="search-box">
                                    <input type="text" id="pdfSearchInput" placeholder="Search in PDF... (Ctrl/Cmd+F)">
                                    <button class="btn btn-primary" id="searchPdf">üîç Search</button>
                                    <button class="btn btn-secondary" id="clearSearch" style="display: none;">Clear</button>
                                </div>
                            </div>
                            
                            <!-- PDF Search results panel -->
                            <div id="pdfSearchResults" class="epub-panel" style="display: none;"></div>
                            
                            <div class="pdf-canvas-container" id="pdfCanvasContainer">
                                <!-- Canvases will be created dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PDF Merge -->
        <div class="tool-section" id="merge">
            <div class="card">
                <h2>Merge PDFs</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    Combine multiple PDF files into one. Drag to reorder.
                </p>
                
                <div class="drop-zone" id="mergeDropZone">
                    <div class="drop-zone-icon">üìë</div>
                    <p>Drag & drop PDF files here or click to select</p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 10px;">You can select multiple files</p>
                    <input type="file" id="mergeInput" accept=".pdf,application/pdf" multiple>
                </div>
                
                <div class="pdf-list" id="mergeList">
                    <p style="text-align: center; color: var(--text-muted);">No PDFs added yet</p>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="mergePdfs" disabled>üîó Merge PDFs</button>
                    <button class="btn btn-secondary" id="clearMerge">Clear All</button>
                </div>
            </div>
        </div>
        
        <!-- PDF Split -->
        <div class="tool-section" id="split">
            <div class="card">
                <h2>Split PDF</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    Extract specific pages from a PDF file.
                </p>
                
                <div class="drop-zone" id="splitDropZone">
                    <div class="drop-zone-icon">üìÑ</div>
                    <p>Drag & drop a PDF file here or click to select</p>
                    <input type="file" id="splitInput" accept=".pdf,application/pdf">
                </div>
                
                <div id="splitContent" style="display: none;">
                    <div class="file-info" id="splitInfo"></div>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px; color: var(--text-muted);">
                            Enter page range (e.g., "1-3, 5, 7-9"):
                        </label>
                        <input type="text" id="pageRange" placeholder="1-3, 5, 7-9" 
                               style="width: 100%; max-width: 400px; padding: 12px; background: var(--bg); 
                                      border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 1rem;">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="extractPages">‚úÇÔ∏è Extract Pages</button>
                        <button class="btn btn-secondary" id="clearSplit">Clear</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- EPUB Reader -->
        <div class="tool-section" id="epub">
            <div class="card">
                <h2>üìö EPUB Reader</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    Read EPUB books with a beautiful, customizable reading experience powered by epub.js
                </p>
                
                <div class="drop-zone" id="epubDropZone">
                    <div class="drop-zone-icon">üìö</div>
                    <p>Drag & drop an EPUB file here or click to select</p>
                    <input type="file" id="epubInput" accept=".epub,application/epub+zip">
                </div>
                
                <div id="epubContent" style="display: none;">
                    <div class="file-info" id="epubInfo"></div>
                    
                    <div class="epub-controls">
                        <label>Font Size:</label>
                        <select id="epubFontSize">
                            <option value="80">Small</option>
                            <option value="100" selected>Medium</option>
                            <option value="120">Large</option>
                            <option value="140">X-Large</option>
                        </select>
                        
                        <label>Theme:</label>
                        <select id="epubTheme">
                            <option value="light">Light</option>
                            <option value="sepia">Sepia</option>
                            <option value="dark">Dark</option>
                        </select>
                        
                        <label>Font:</label>
                        <select id="epubFont">
                            <option value="Georgia, serif">Georgia</option>
                            <option value="'Times New Roman', serif">Times</option>
                            <option value="-apple-system, sans-serif">System</option>
                            <option value="'Courier New', monospace">Monospace</option>
                        </select>
                        
                        <div class="epub-nav-btns">
                            <button class="btn btn-secondary" id="prevChapter">‚Üê Prev</button>
                            <button class="btn btn-secondary" id="nextChapter">Next ‚Üí</button>
                        </div>
                    </div>
                    
                    <!-- Enhanced controls for search and bookmarks -->
                    <div class="epub-enhanced-controls">
                        <div class="search-box">
                            <input type="text" id="epubSearchInput" placeholder="Search in book... (Ctrl/Cmd+F)">
                            <button class="btn btn-primary" id="searchEpub">üîç Search</button>
                        </div>
                        <div class="bookmark-controls">
                            <button class="btn btn-secondary" id="addBookmark">üîñ Add Bookmark (Ctrl/Cmd+D)</button>
                            <button class="btn btn-secondary" id="showBookmarks">üìö View Bookmarks</button>
                            <span id="readingStats" style="margin-left: 15px; color: var(--text-muted);"></span>
                        </div>
                    </div>
                    
                    <!-- Search results panel -->
                    <div id="searchResultsPanel" class="epub-panel" style="display: none;"></div>
                    
                    <!-- Bookmarks panel -->
                    <div id="bookmarksPanel" class="epub-panel" style="display: none;"></div>
                    
                    <div class="epub-container">
                        <div class="epub-toc" id="epubToc">
                            <h3>üìñ Table of Contents</h3>
                            <div id="tocList"></div>
                        </div>
                        <div class="epub-main">
                            <div class="epub-content" id="epubReaderContainer">
                                <div id="epub-reader"></div>
                            </div>
                            <div class="chapter-progress">
                                <span id="currentPercent">0%</span>
                                <input type="range" id="progressSlider" min="0" max="100" value="0">
                                <span id="totalPercent">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PDF Password Remover -->
        <div class="tool-section" id="unlock">
            <div class="card">
                <h2>üîì PDF Password Remover</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    Remove password protection from PDF files. You'll need to know the password to unlock.
                </p>
                
                <div class="drop-zone" id="unlockDropZone">
                    <div class="drop-zone-icon">üîí</div>
                    <p>Drag & drop a password-protected PDF here or click to select</p>
                    <input type="file" id="unlockInput" accept=".pdf,application/pdf">
                </div>
                
                <div id="unlockContent" style="display: none;">
                    <div class="file-info" id="unlockInfo"></div>
                    
                    <div class="password-status" id="passwordStatus">
                        <span class="icon">üîí</span>
                        <div>
                            <strong>Status: </strong><span id="statusText">Checking...</span>
                        </div>
                    </div>
                    
                    <div id="passwordSection">
                        <div class="password-input-group">
                            <input type="password" id="pdfPassword" placeholder="Enter PDF password">
                            <button class="btn btn-warning" id="unlockPdf">üîì Unlock & Remove Password</button>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 10px;">
                            üí° The unlocked PDF will have no password protection and can be opened freely.
                        </p>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="clearUnlock">Clear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>